# ç«¯å£è½¬å‘/éš§é“

## ä»‹ç»

1ï¼‰ç«¯å£è½¬å‘ï¼ˆPort Forwardï¼‰

æŠŠAï¼šæœ¬åœ°æŸç«¯å£çš„æµé‡è½¬å‘åˆ°Bï¼šæŸIPæŸç«¯å£

å¾—åˆ°çš„æ•ˆæœï¼šä¼ªè£…æˆæœ¬åœ°çš„åœ°å€è®¿é—®æœ¬åœ°æœåŠ¡ï¼ˆä»æŸç»•è¿‡IPæ£€æµ‹ï¼‰

2ï¼‰éš§é“ï¼ˆTunnelï¼‰

æ›´æ³›ï¼šå¯ä»¥æ˜¯ç«¯å£è½¬å‘ã€SOCKSä»£ç†ã€ç”šè‡³æ•´ä¸ªç½‘æ®µè½¬å‘ã€‚

â€‹	â‘ æœ¬åœ°ç«¯å£è½¬å‘ï¼ˆLï¼‰

â€‹	â‘¡SOCKSä»£ç†ï¼ˆDï¼‰

3ï¼‰ä»€ä¹ˆæ—¶å€™è¯¥ç”¨

â€‹	1ï¼‰æœåŠ¡åªç›‘å¬127.0.0.1

â€‹	2ï¼‰æœåŠ¡åªåœ¨å†…ç½‘ç½‘æ®µå¼€æ”¾

â€‹	3ï¼‰æ‹¿ä¸‹äº†ä¸€å°è·³æ¿æœºï¼ˆpivotï¼‰

â€‹	4ï¼‰éœ€è¦ç”¨æ¸¸è§ˆå™¨å†…ç½‘è®¿é—®Web

â€‹	5ï¼‰è¦æŠŠåå¼¹çš„Shellæ‹‰å›æ¥ï¼Œä½†ç½‘ç»œä¸é€š

## ä¸‰ç§è½¬å‘ï¼ˆL/R/Dï¼‰

### A.æœ¬åœ°è½¬å‘ï¼ˆLocal Forwardï¼‰

æŠŠKaliçš„æœ¬åœ°ç«¯å£->è½¬åˆ°å†…ç½‘æœåŠ¡

æ¨¡å‹ï¼š

Kaliï¼šLocalPort -> JumpHost -> InternalIp:TargetPort

### B.è¿œç¨‹è½¬å‘ï¼ˆRemote Forwardï¼‰

æŠŠè·³æ¿æœºä¸Šçš„ç«¯å£->è½¬å‘åˆ°Kaliçš„æŸä¸ªç«¯å£

ç”¨é€”ï¼šç›®æ ‡ç½‘ç»œä¸èƒ½ç›´æ¥è¿æ¥ä½ ï¼Œä½†æ˜¯èƒ½è¿è·³æ¿æœº

æ¨¡å‹ï¼š

JumpHost:RemotePort -> SSHéš§é“ -> Kali:LocalPort

### C.åŠ¨æ€è½¬å‘ï¼ˆDynamic Forward Socksï¼‰

åœ¨Kaliæœºå¼€ä¸€ä¸ªSocks5ä»£ç†ï¼Œè®©å·¥å…·ï¼ˆæ¸¸è§ˆå™¨/proxychainsï¼‰é€šè¿‡è·³æ¿æœºè®¿é—®å†…ç½‘çš„ä»»æ„åœ°å€ç«¯å£ã€‚

ç”¨é€”ï¼šå†…ç½‘Webã€å¤šä¸ªç«¯å£è¦è®¿é—®ã€æ‡’å¾—ä¸€ä¸ªä¸€ä¸ª-L

## Linux

### 1ï¼‰SSHï¼ˆæœ€é‡è¦ï¼‰

é€‚ç”¨ï¼šæœ‰SSHå‡­æ®

ï¼ˆ1ï¼‰æœ¬åœ°ç«¯å£è½¬å‘ -L

ï¼ˆ2ï¼‰è¿œç¨‹ç«¯å£è½¬å‘ -R

ï¼ˆ3ï¼‰åŠ¨æ€ç«¯å£è½¬å‘Socks -D

ğŸ‘‰ å¸¸ç”¨

#### 	â‘ æœ¬åœ°ç«¯å£è½¬å‘

â€‹	ssh -N -L 127.0.0.1:8080:TargetIp:TargetPort USER@TargetIp

#### 	â‘¡åŠ¨æ€è½¬å‘Socks5

â€‹	ssh -N -D 127.0.0.1:1080 USER@JUMP

#### 	â‘¢è¿œç¨‹ç«¯å£è½¬å‘

â€‹	ssh -N -R 0.0.0.0:8080:127.0.0.1:8080 USER@JUMP

### 2ï¼‰chiselï¼ˆHTTPéš§é“ï¼‰

é€‚ç”¨ï¼šæ²¡æœ‰SSH,ä½†èƒ½æ‰§è¡Œæ–‡ä»¶

ï¼ˆ1ï¼‰æœ¬åœ°è½¬å‘

ï¼ˆ2ï¼‰è¿œç¨‹è½¬å‘

ï¼ˆ3ï¼‰èµ°Socksä»£ç†

ï¼ˆ4ï¼‰èµ°HTTP/HTTPSï¼ˆç©¿é˜²ç«å¢™ï¼‰

ğŸ‘‰ å¸¸ç”¨

##### è·³æ¿æœºï¼ˆå®¢æˆ·ç«¯ï¼‰å›è¿Kaliï¼Œå¹¶å¼€æ”¾ç«¯å£ç»™Kali

â‘ Server

â€‹	./chisel server --reverse -p 8080

â‘¡Client

â€‹	chisel client KALI:8080 R:8080:INTERNAL:80

Ræ˜¯â€œåå‘éš§é“â€å†™æ³•ï¼Œå› ä¸ºé€šå¸¸æ˜¯å†…ç½‘æœºå‡ºç«™è¿ä½ 

##### chisel Socks5ï¼ˆç­‰ä»· ssh -Dï¼‰

Kaliï¼š

â€‹	./chisel server --reverse -p 8000

è·³æ¿:

â€‹	./chisel client KALI:8000 R:1080:socks



### 3ï¼‰socatï¼ˆå•ç«¯å£è½¬å‘ï¼‰

é€‚ç”¨ï¼šä¸´æ—¶æ•‘æ€¥

ï¼ˆ1ï¼‰TCP<->TCPè½¬å‘

ï¼ˆ2ï¼‰ç›‘å¬ç«¯å£è½¬å‘

ğŸ‘‰ åŠŸèƒ½å•ä¸€ï¼Œç¯å¢ƒé‡Œå¸¸è‡ªå¸¦

åœ¨â€œè·³æ¿æœºâ€ç›‘å¬8080ï¼Œè½¬åˆ°å†…ç½‘80

socat TCP-LISTEN:8080,fork TCP:INTERNAL:80

### 4ï¼‰netcatï¼ˆéå¸¸æœ‰é™ï¼‰

é€‚ç”¨ï¼šæç®€åœºæ™¯

ï¼ˆ1ï¼‰ç«¯å£ä¸­ç»§

ï¼ˆ2ï¼‰ä¸ç¨³å®šï¼Œä¸æ¨èåšå¤æ‚éš§é“

## Windows

### 1ï¼‰netsh portproxyï¼ˆWindowså†…ç½®ï¼Œç®¡ç†å‘˜ï¼‰

é€‚ç”¨ï¼šæœ‰ç®¡ç†å‘˜æƒé™

ï¼ˆ1ï¼‰TCPç«¯å£è½¬å‘

ï¼ˆ2ï¼‰ä¸éœ€è¦é¢å¤–å·¥å…·

ğŸ‘‰ Windowsé¦–é€‰

è®©è·³æ¿æœºç›‘å¬0.0.0.0:8080->è½¬åˆ°Internal:80

net interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=8080 connectaddress=INMTERNAL connectport=80

æŸ¥çœ‹è§„åˆ™ï¼š

netsh interface portproxy show all

åˆ é™¤è§„åˆ™ï¼š

netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=8080

å¸¸è§é…å¥—ï¼š

netsh advfirewall firewall add rule name="portproxy  8080" dir=in action=allow protocol=TCP localport=8080

### 2ï¼‰chiselï¼ˆè·¨å¹³å°é¦–é€‰ï¼‰

é€‚ç”¨ï¼šæ— SSH/æƒ³å¿«

ï¼ˆ1ï¼‰å’ŒLinuxä¸€æ ·

ï¼ˆ2ï¼‰Windows/Linuxé€šç”¨

ï¼ˆ3ï¼‰éå¸¸ç¨³å®š

ğŸ‘‰ æŒæ¡

### 3ï¼‰plinkï¼ˆPutty CLIï¼‰

é€‚ç”¨ï¼šWindowsä¸ŠåšSSHéš§é“

ï¼ˆ1ï¼‰-L/-R/-D

ï¼ˆ2ï¼‰å½“Windowsæ²¡æœ‰sshå®¢æˆ·ç«¯æ—¶ç”¨

### 4ï¼‰PowerShell

é€‚ç”¨ï¼šç‰¹æ®Šé™åˆ¶åœºæ™¯

ï¼ˆ1ï¼‰ç®€å•TCPè½¬å‘

ï¼ˆ2ï¼‰ä¸ç¨³å®š

## å†³ç­–

| åœºæ™¯                | é€‰ä»€ä¹ˆ                   |
| ------------------- | ------------------------ |
| æœ‰SSH               | SSH(-L /-D /-R)          |
| æ²¡æœ‰SSHï¼Œæœ‰æ‰§è¡Œæƒé™ | chisel                   |
| Windowsç®¡ç†å‘˜       | netsh portproxy          |
| åªè½¬ä¸€ä¸ªç«¯å£        | socat                    |
| æƒ³è®¿é—®å¤šä¸ªå†…ç½‘æœåŠ¡  | SOCKSï¼ˆSSH -D / chiselï¼‰ |

Linuxï¼šSSH/chisel

Windowsï¼šnetsh/chisel