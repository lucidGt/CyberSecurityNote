#  Kerberos-AS-REP Roasting

## 什么是用户未启用Kerberos预认证？

正常Kerberos登录流程里，用户在拿到AS-REP之前，要先证明“我知道自己的密码”？

但如果一个用户被设置成：不需要Kerberos预认证

那就等于：

1）DC在你还没证明身份之前

2）就先把AS-REP发给你

配置错误，不是漏洞

## 不需要登录即可拿到AS-REP

不需要已有域账号

1）Kerberoast：

​	你必须先是域用户

2）AS-REP Roasting

​	你甚至可以什么账号都没有

只要

1）知道某个用户名

2）这个用户未启用预认证

就能向DC请求它的AS-REP

## 爆破得到域用户密码怎么理解？

AS-REP有一段数据：

​	1）是用该用户派生密钥加密的

所以可以：

​	1）把这段数据拿出来

​	2）离线猜密码

​	3）猜对了->该域用户的真实密码

| 项目         | Kerberoast | AS-REP Roasting |
| ------------ | ---------- | --------------- |
| 爆破谁       | 服务账号   | 普通域用户      |
| 是否需要登录 | 需要       | 不需要          |
| 前提条件     | 有SPN      | 无预认证        |

## 为什么说比Kerberoast少，但很常见？

1）未启用认证的用户现实中没那么多

2）比SPN服务账号更明显配置错误

1）不依赖你已有权限

2）爆到的是真实域用户密码

3）很容易作为第一步入口

4）可以直接相接后续AD攻击链

## 和Kerberroast分工

AS-REP Roasting

给你第一个域身份

Kerbearoast

帮你升级更强的身份